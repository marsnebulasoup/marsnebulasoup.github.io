<!DOCTYPE html>
<html class="family-primary">

<head>
    <title>Find the perfect movie</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="css/bulma_custom/css/mystyles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="js/smoothscroll/smoothscroll.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>
</head>
<style>
    .movie-trailer {
        width: 100%;
        height: 30vh;
        object-fit: cover;
        -webkit-mask-image: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 1)), to(rgba(0, 0, 0, 0)));
        mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));
    }

    .movie-poster {
        max-height: 30vh;
        max-width: 30vh;
        border-radius: 5px;
    }

    .movie-title {
        color: white;
        font-size: 2em;
        font-weight: 600;
    }

    .movie-info {
        font-size: 1em;
        padding-top: 0.8em;
        color: #b3b3b3;
    }

    .movie-info p {
        padding-bottom: 0.8em;
    }

    .movie-boxed {
        border-radius: 2px;
        border: 1.5px solid #b3b3b3;
        padding-top: 1px;
        padding-bottom: 1px;
        padding-left: 2px;
        padding-right: 2px;
    }

    .movie-plot {
        border: 2px solid #b3b3b3;
        border-right: none;
        border-bottom: none;
        border-top: none;
        padding-left: 0.7em;
    }

    .actor-container {
        position: relative;
        display: inline-flex;
        justify-content: center;
        width: min-content;
    }

    .actor-name {
        position: absolute;
        bottom: 1em;
        padding: 0.3em;
        font-size: 0.8em;
        max-width: 80%;
        white-space: normal;
        word-wrap: break-word;
        background-color: black;
        color: white;
    }

    .actor-name p {
        text-align: center;
    }

    .scrollmenu {
        flex: auto !important;
        overflow: auto;
        white-space: nowrap;
        -ms-overflow-style: none;
        scrollbar-width: none;
        scroll-behavior: smooth;
    }

    .scrollmenu::-webkit-scrollbar {
        display: none;
    }

    .scrollmenu img {
        margin-left: 0.5em;
        margin-right: 0.5em;
        box-shadow: 1px 1px 12px 0px black;
    }

    .scrollarrows {
        display: flex;
        align-items: center;
        width: min-content;
    }

    .tilebox {
        background-color: #090979;
        border-radius: 10px;
        margin: 0.5em;
    }

    .moreinfo p {
        padding-bottom: 1em;
    }


    @media (max-width: 768px) {

        /*mobile*/
        .movie-trailer {
            height: 20vh;
        }

        .movie-poster {
            max-height: 18vh;
            max-width: 18vh;
        }

        .movie-title {
            font-size: 1.5em;
        }

        .movie-info {
            font-size: 0.8em;
        }

        .actor-name {
            font-size: 0.5em;
            max-width: 10vh;
        }

        .scrollmenu {
            flex: initial;
        }

        .scrollmenu img {
            margin-right: 0.5em;
        }

        .scrollarrows {
            display: none;
        }
    }
</style>

<body>
    <section id="app" class="hero" >
        <div class="hero-head">
            <div>
                <img class="movie-trailer" v-bind:src="movie.Poster" />
            </div>
        </div>
        <div class="hero-body" style="display: none;" v-show="!_.isEmpty(movie)">
            <div class="columns is-mobile is-centered is-multiline">
                <div class="column is-narrow">
                    <img class="movie-poster" v-bind:src="movie.Poster" />
                </div>
                <div class="column">
                    <h1 class="movie-title">
                        {{movie.Title}}
                        <!-- Those magnificent men and their flying machines, or how I flew from Londen to Paris in 23 hours 11 minutes -->
                    </h1>
                    <div class="movie-info">
                        <p>{{movie.Year}} &middot; {{movie.Runtime}} &middot; <span
                                class="movie-boxed">{{movie.Rated}}</span></p>
                        <p>IMDb {{movie.imdbRating}} &middot; {{movie.Genre}}</p>
                        <a id="watchlist"
                            onclick="WatchlistHandler(this, overlay.currentmovieid, overlay.title, overlay.poster);"
                            class="button is-rounded is-small is-primary">
                            <span style="display: none;">
                                <i class="fas fa-check"></i>
                                &nbsp;
                                Watchlist
                                &nbsp;
                            </span>
                            <span>
                                <i class="fas fa-plus"></i>
                                &nbsp;
                                Watchlist
                                &nbsp;
                            </span>
                        </a>
                    </div>
                </div>
                <div class="column is-12" style="height: 0 !important; width: 0 !important"></div>
                <div class="column is-10-desktop is-10-widescreen is-11-tablet is-12-mobile">
                    <p class="movie-plot">
                        <span style="font-variant: small-caps; font-weight: 600; color: #b3b3b3;">plot</span>
                        <br>
                        {{movie.Plot}}
                    </p>
                </div>

                <div class="column is-12 movie-title">
                    <p>Similar</p>
                </div>
                <div class="column is-narrow scrollarrows">
                    <i onclick="document.getElementById('similar').scrollBy({ top: 0, left: -300, behavior: 'smooth' });"
                        class="fas fa-arrow-left fa-2x" style="margin-right: 0.3em;">
                    </i>
                </div>
                <div id="similar" class="column is-10-desktop is-12-mobile scrollmenu">

                </div>
                <div class="column is-narrow scrollarrows">
                    <i onclick="document.getElementById('similar').scrollBy({ top: 0, left: 300, behavior: 'smooth' });"
                        class="fas fa-arrow-right fa-2x" style="margin-left: 0.3em;">
                    </i>
                </div>

                <div class="column is-12 movie-title">
                    <p>Cast</p>
                </div>
                <div class="column is-narrow scrollarrows">
                    <i onclick="document.getElementById('cast').scrollBy({ top: 0, left: -300, behavior: 'smooth' });"
                        class="fas fa-arrow-left fa-2x" style="margin-right: 0.3em;">
                    </i>
                </div>
                <div id="cast" class="column is-10-desktop is-12-mobile scrollmenu">
                </div>
                <div class="column is-narrow scrollarrows">
                    <i onclick="document.getElementById('cast').scrollBy({ top: 0, left: 300, behavior: 'smooth' });"
                        class="fas fa-arrow-right fa-2x" style="margin-left: 0.3em;">
                    </i>
                </div>

                <div class="column is-12 movie-title">
                    <p>Writer(s)</p>
                </div>
                <div class="column is-narrow scrollarrows">
                    <i onclick="document.getElementById('writers').scrollBy({ top: 0, left: -300, behavior: 'smooth' });"
                        class="fas fa-arrow-left fa-2x" style="margin-right: 0.3em;">
                    </i>
                </div>
                <div id="writers" class="column is-10-desktop is-12-mobile scrollmenu">
                </div>
                <div class="column is-narrow scrollarrows">
                    <i onclick="document.getElementById('writers').scrollBy({ top: 0, left: 300, behavior: 'smooth' });"
                        class="fas fa-arrow-right fa-2x" style="margin-left: 0.3em;">
                    </i>
                </div>

                <div class="column is-12 movie-title">
                    <p>Details</p>
                </div>

                <div class="column is-11-desktop is-12-mobile">
                    <div class="tile is-ancestor">
                        <div class="tile is-vertical is-parent is-4 tilebox">
                            <div class="tile is-child">
                                <p class="subtitle">Director</p>
                                <div style="display: flex;">
                                    <div style="margin-right: 1em;">
                                        <div class="actor-container">
                                            <img id="directorposter" class="movie-poster">
                                            <div class="actor-name">
                                                <p>{{movie.Director}}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <p style="font-weight: 600; padding-bottom: 0.3em;">Known for</p>
                                        <p id="knownfor">
                                            This director wasn't known for anything.
                                        </p>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="tile is-vertical is-parent tilebox">
                            <p class="subtitle">More info</p>
                            <div class="tile moreinfo">
                                <div class="tile is-child">
                                    <p style="font-weight: 600">General Info</p>
                                    <p>Released: 04 Oct 2019</p>
                                    <p>Language: English</p>
                                    <p>Country: USA, Canada</p>
                                    <p>Awards: N/A </p>
                                </div>
                                <div class="tile is-child">
                                    <p style="font-weight: 600">Ratings</p>
                                    <p>Internet Movie Database: 8.9/10</p>
                                    <p>Rotten Tomatoes: 78%</p>
                                    <p>Metacritic: 34/100</p>
                                </div>
                                <div class="tile is-child">
                                    <p style="font-weight: 600">Details</p>
                                    <p>BoxOffice: N/A</p>
                                    <p>Production: Warner Bros. Pictures</p>
                                    <p>Website: N/A</p>
                                    <p>IMDb ID: tt34343</p>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                //movie: { "Title": "Joker", "Year": "2019", "Rated": "R", "Released": "04 Oct 2019", "Runtime": "122 min", "Genre": "Crime, Drama, Thriller", "Director": "Todd Phillips", "Writer": "Todd Phillips, Scott Silver, Bob Kane (based on characters created by), Bill Finger (based on characters created by), Jerry Robinson (based on characters created by)", "Actors": "Joaquin Phoenix, Robert De Niro, Zazie Beetz, Frances Conroy", "Plot": "In Gotham City, mentally-troubled comedian Arthur Fleck is disregarded and mistreated by society. He then embarks on a downward spiral of revolution and bloody crime. This path brings him face-to-face with his alter-ego: \"The Joker\".", "Language": "English", "Country": "USA, Canada", "Awards": "N/A", "Poster": "https://m.media-amazon.com/images/M/MV5BNGVjNWI4ZGUtNzE0MS00YTJmLWE0ZDctN2ZiYTk2YmI3NTYyXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_SX300.jpg", "Ratings": [{ "Source": "Internet Movie Database", "Value": "8.9/10" }, { "Source": "Rotten Tomatoes", "Value": "68%" }, { "Source": "Metacritic", "Value": "59/100" }], "Metascore": "59", "imdbRating": "8.9", "imdbVotes": "360,218", "imdbID": "tt7286456", "Type": "movie", "DVD": "N/A", "BoxOffice": "N/A", "Production": "Warner Bros. Pictures", "Website": "N/A", "Response": "True" }
                movie: {}
            }
        });

        function parseQuery(queryString) {
            var query = {};
            var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split('=');
                query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
            }
            return query;
        }

        async function LoadJSON() {
            const query = window.location.search;
            const parsed = parseQuery(query);
            const id = parsed.id;

            fetch("db/ind/" + id + ".json")
                .then(res => {
                    if (!res.ok) {
                        throw new Error("Failed with HTTP code " + response.status);
                    }
                    return res.json()
                })
                .then(json => {
                    app.movie = json;
                    LoadImages();
                })
                .catch(err => {
                    console.log("Error: " + err);
                })

        }

        async function LoadImages() {
            var similarurl = "https://api.themoviedb.org/3/movie/" + app.movie.imdbID + "/similar?api_key=8ca85a295652c75508670fd4aa6907ce&language=en-US&page=1";
            fetch(similarurl)
                .then(res => {
                    if (!res.ok) {
                        throw new Error("Failed with HTTP code " + response.status);
                    }
                    return res.json()
                })
                .then(json => {
                    var similar = document.getElementById("similar");
                    similar.innerHTML = ""
                    json.results.forEach(movie => {
                        var m = `<div class="actor-container">
                        <img class="movie-poster" src="` + verifyImg(movie.poster_path) + `">
                        <div class="actor-name">
                            <p>` + movie.title + `</p>
                        </div>
                    </div>`
                        similar.insertAdjacentHTML("beforeend", m);
                    });
                })
                .catch(err => {
                    console.log("Error: " + err);
                })

            var casturl = "https://api.themoviedb.org/3/movie/" + app.movie.imdbID + "/credits?api_key=8ca85a295652c75508670fd4aa6907ce";
            fetch(casturl)
                .then(res => {
                    if (!res.ok) {
                        throw new Error("Failed with HTTP code " + response.status);
                    }
                    return res.json()
                })
                .then(json => {
                    console.log(json)
                    var cast = document.getElementById("cast");
                    cast.innerHTML = ""
                    json.cast.forEach(person => {
                        var m = `<div class="actor-container">
                        <img class="movie-poster" src="` + verifyImg(person.profile_path) + `">
                        <div class="actor-name">
                            <p>` + person.name + `</p>
                        </div>
                    </div>`
                        cast.insertAdjacentHTML("beforeend", m);
                    });
                })
                .catch(err => {
                    console.log("Error: " + err);
                })

            var writers = document.getElementById("writers");
            writers.innerHTML = "";
            app.movie.Writer.split(", ").forEach(person => {
                writer = person.replace(/ *\([^)]*\) */g, "");
                var writerurl = "https://api.themoviedb.org/3/search/person?query=" + writer + "&api_key=8ca85a295652c75508670fd4aa6907ce&language=en-US&page=1&include_adult=false";
                fetch(writerurl)
                    .then(res => {
                        if (!res.ok) {
                            throw new Error("Failed with HTTP code " + response.status);
                        }
                        return res.json()
                    })
                    .then(json => {
                        console.log(writerurl);
                        var info = json.results[0];
                        var m = `<div class="actor-container">
                        <img class="movie-poster" src="` + verifyImg(info.profile_path) + `">
                        <div class="actor-name">
                            <p>` + info.name + `</p>
                        </div>
                    </div>`
                        writers.insertAdjacentHTML("beforeend", m);
                    })
                    .catch(err => {
                        console.log("Error: " + err);
                    })
            });

            var directorurl = "https://api.themoviedb.org/3/search/person?api_key=8ca85a295652c75508670fd4aa6907ce&language=en-US&query=" + app.movie.Director + "&page=1&include_adult=false";
            fetch(directorurl)
                .then(res => {
                    if (!res.ok) {
                        throw new Error("Failed with HTTP code " + response.status);
                    }
                    return res.json()
                })
                .then(json => {
                    document.getElementById("directorposter").setAttribute("src", verifyImg(json.results[0].profile_path));
                    var known_for = document.createElement("ul");
                    json.results[0].known_for.forEach(movie => {
                        var child = document.createElement("li");
                        child.innerText = movie.title;
                        known_for.appendChild(child);
                    });

                    var known_for_container = document.getElementById("knownfor");
                    known_for_container.innerHTML = "";
                    known_for_container.appendChild(known_for);
                })
                .catch(err => {
                    console.log("Error: " + err);
                })
        }

        function verifyImg(img){
            if(img == null){
                return "images/unknown.png"
            }
            return "https://image.tmdb.org/t/p/w185/" + img;
        }
        
        LoadJSON();    
    </script>
</body>

</html>